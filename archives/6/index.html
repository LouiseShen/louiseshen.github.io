<!DOCTYPE html>
<html lang="en">
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.2.0'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>Algorithm in Swift -- Base64 - Macondo</title>
  
    <meta name="keywords" content="algorithm,swift">
  

  
    <meta name="description" content="In this article I will implement Base64 decoder & encoder without using Foundation's pre-build one.">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  
    <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000132.ico">
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

</head>

<body>
  

<header id="l_header" class="l_header auto shadow blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
            Macondo
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/moon.html
                  
                  
                  
                    id="moonhtml"
                  >
                  <i class='fas fa-book fa-fw'></i>Moon
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/anime.html
                  
                  
                  
                    id="animehtml"
                  >
                  <i class='fab fa-youtube fa-fw'></i>Anime
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/film.html
                  
                  
                  
                    id="filmhtml"
                  >
                  <i class='fas fa-film fa-fw'></i>TV
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archive
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://louisedev.team
                  
                  
                  
                    id="https:louisedevteam"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-language fa-fw'></i>Language
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/
                  
                  
                  
                    id="https:blog5v5lol"
                  >
                  English
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/zh-tw/
                  
                  
                  
                    id="https:blog5v5lolzh-tw"
                  >
                  台灣正體
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/zh-cn/
                  
                  
                  
                    id="https:blog5v5lolzh-cn"
                  >
                  大陆简体
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>Darkmode
                </a>
              <li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/moon.html
                  
                  
                  
                    id="moonhtml"
                  >
                  <i class='fas fa-book fa-fw'></i>Moon
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/anime.html
                  
                  
                  
                    id="animehtml"
                  >
                  <i class='fab fa-youtube fa-fw'></i>Anime
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/film.html
                  
                  
                  
                    id="filmhtml"
                  >
                  <i class='fas fa-film fa-fw'></i>TV
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>Archive
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://louisedev.team
                  
                  
                  
                    id="https:louisedevteam"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>About
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-language fa-fw'></i>Language
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/
                  
                  
                  
                    id="https:blog5v5lol"
                  >
                  English
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/zh-tw/
                  
                  
                  
                    id="https:blog5v5lolzh-tw"
                  >
                  台灣正體
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=https://blog.5v5.lol/zh-cn/
                  
                  
                  
                    id="https:blog5v5lolzh-cn"
                  >
                  大陆简体
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>Darkmode
                </a>
              <li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div id="l_body">
    <div id="l_cover">
  
    
        <div id="full" class='cover-wrapper post dock' style="display: none;">
          
            <div class='cover-bg lazyload placeholder' data-bg="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg"></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">Volantis</p>
    
    
  </div>
  <div class='bottom'>
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/v4/getting-started/"
              
              
              id="v4getting-started">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg'><p>文档</p>
            </a>
          
            <a href="/faqs/"
              
              
              id="faqs">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg'><p>帮助</p>
            </a>
          
            <a href="/examples/"
              
              
              id="examples">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f396.svg'><p>示例</p>
            </a>
          
            <a href="/contributors/"
              
              
              id="contributors">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f389.svg'><p>社区</p>
            </a>
          
            <a href="/archives/"
              
              
              id="archives">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg'><p>博客</p>
            </a>
          
            <a target="_blank" rel="noopener" href="https://github.com/volantis-x/hexo-theme-volantis/"
              
              
              id="https:githubcomvolantis-xhexo-theme-volantis">
              <img src='https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg'><p>源码</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

    <div id='safearea'>
      <div class='body-wrapper' id="pjax-container">
        

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        Algorithm in Swift -- Base64
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/avatar_256x256.webp">
    <p>Louise</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/Algorithm/">Algorithm</a>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>Post on Jan 2, 2021</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse leancloud">
    <a class='notlink'>
      
      <div id="lc-pv" data-title="Algorithm in Swift -- Base64" data-path="/archives/6/">
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
         views
      </div>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  <p>Base64 is a group of binary-to-text encoding schemes that represent binary data in an ASCII string format by translating it into a radix-64 representation.</p>
<p>In this article I will implement Base64 decoder &amp; encoder without using Foundation’s pre-build one.</p>
<h2 id="Base64-Table"><a href="#Base64-Table" class="headerlink" title="Base64 Table"></a>Base64 Table</h2><table>
<thead>
<tr>
<th>Index</th>
<th>Binary</th>
<th>Char</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>00000000</td>
<td>A</td>
</tr>
<tr>
<td>1</td>
<td>00000001</td>
<td>B</td>
</tr>
<tr>
<td>2</td>
<td>00000010</td>
<td>C</td>
</tr>
<tr>
<td>3</td>
<td>00000011</td>
<td>D</td>
</tr>
<tr>
<td>4</td>
<td>00000100</td>
<td>E</td>
</tr>
<tr>
<td>5</td>
<td>00000101</td>
<td>F</td>
</tr>
<tr>
<td>6</td>
<td>00000110</td>
<td>G</td>
</tr>
<tr>
<td>7</td>
<td>00000111</td>
<td>H</td>
</tr>
<tr>
<td>8</td>
<td>00001000</td>
<td>I</td>
</tr>
<tr>
<td>9</td>
<td>00001001</td>
<td>J</td>
</tr>
<tr>
<td>10</td>
<td>00001010</td>
<td>K</td>
</tr>
<tr>
<td>11</td>
<td>00001011</td>
<td>L</td>
</tr>
<tr>
<td>12</td>
<td>00001100</td>
<td>M</td>
</tr>
<tr>
<td>13</td>
<td>00001101</td>
<td>N</td>
</tr>
<tr>
<td>14</td>
<td>00001110</td>
<td>O</td>
</tr>
<tr>
<td>15</td>
<td>00001111</td>
<td>P</td>
</tr>
<tr>
<td>16</td>
<td>00010000</td>
<td>Q</td>
</tr>
<tr>
<td>17</td>
<td>00010001</td>
<td>R</td>
</tr>
<tr>
<td>18</td>
<td>00010010</td>
<td>S</td>
</tr>
<tr>
<td>19</td>
<td>00010011</td>
<td>T</td>
</tr>
<tr>
<td>20</td>
<td>00010100</td>
<td>U</td>
</tr>
<tr>
<td>21</td>
<td>00010101</td>
<td>V</td>
</tr>
<tr>
<td>22</td>
<td>00010110</td>
<td>W</td>
</tr>
<tr>
<td>23</td>
<td>00010111</td>
<td>X</td>
</tr>
<tr>
<td>24</td>
<td>00011000</td>
<td>Y</td>
</tr>
<tr>
<td>25</td>
<td>00011001</td>
<td>Z</td>
</tr>
<tr>
<td>26</td>
<td>00011010</td>
<td>a</td>
</tr>
<tr>
<td>27</td>
<td>00011011</td>
<td>b</td>
</tr>
<tr>
<td>28</td>
<td>00011100</td>
<td>c</td>
</tr>
<tr>
<td>29</td>
<td>00011101</td>
<td>d</td>
</tr>
<tr>
<td>30</td>
<td>00011110</td>
<td>e</td>
</tr>
<tr>
<td>31</td>
<td>00011111</td>
<td>f</td>
</tr>
<tr>
<td>32</td>
<td>00100000</td>
<td>g</td>
</tr>
<tr>
<td>33</td>
<td>00100001</td>
<td>h</td>
</tr>
<tr>
<td>34</td>
<td>00100010</td>
<td>i</td>
</tr>
<tr>
<td>35</td>
<td>00100011</td>
<td>j</td>
</tr>
<tr>
<td>36</td>
<td>00100100</td>
<td>k</td>
</tr>
<tr>
<td>37</td>
<td>00100101</td>
<td>l</td>
</tr>
<tr>
<td>38</td>
<td>00100110</td>
<td>m</td>
</tr>
<tr>
<td>39</td>
<td>00100111</td>
<td>n</td>
</tr>
<tr>
<td>40</td>
<td>00101000</td>
<td>o</td>
</tr>
<tr>
<td>41</td>
<td>00101001</td>
<td>p</td>
</tr>
<tr>
<td>42</td>
<td>00101010</td>
<td>q</td>
</tr>
<tr>
<td>43</td>
<td>00101011</td>
<td>r</td>
</tr>
<tr>
<td>44</td>
<td>00101100</td>
<td>s</td>
</tr>
<tr>
<td>45</td>
<td>00101101</td>
<td>t</td>
</tr>
<tr>
<td>46</td>
<td>00101110</td>
<td>u</td>
</tr>
<tr>
<td>47</td>
<td>00101111</td>
<td>v</td>
</tr>
<tr>
<td>48</td>
<td>00110000</td>
<td>w</td>
</tr>
<tr>
<td>49</td>
<td>00110001</td>
<td>x</td>
</tr>
<tr>
<td>50</td>
<td>00110010</td>
<td>y</td>
</tr>
<tr>
<td>51</td>
<td>00110011</td>
<td>z</td>
</tr>
<tr>
<td>52</td>
<td>00110100</td>
<td>0</td>
</tr>
<tr>
<td>53</td>
<td>00110101</td>
<td>1</td>
</tr>
<tr>
<td>54</td>
<td>00110110</td>
<td>2</td>
</tr>
<tr>
<td>55</td>
<td>00110111</td>
<td>3</td>
</tr>
<tr>
<td>56</td>
<td>00111000</td>
<td>4</td>
</tr>
<tr>
<td>57</td>
<td>00111001</td>
<td>5</td>
</tr>
<tr>
<td>58</td>
<td>00111010</td>
<td>6</td>
</tr>
<tr>
<td>59</td>
<td>00111011</td>
<td>7</td>
</tr>
<tr>
<td>60</td>
<td>00111100</td>
<td>8</td>
</tr>
<tr>
<td>61</td>
<td>00111101</td>
<td>9</td>
</tr>
<tr>
<td>62</td>
<td>00111110</td>
<td>+</td>
</tr>
<tr>
<td>63</td>
<td>00111111</td>
<td>/</td>
</tr>
</tbody></table>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>We can find how Base64 works by looking these examples at a glance.</p>
<p>As this example illustrates, how Base64 encoder converts three octets or bytes into four encoded characters.</p>
<p><img src="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000207.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000207.webp" srcset="data:image/png;base64,666" alt="Img207"></p>
<p>At first, we find the 8 bit binary representation of each character in text.</p>
<p>Then we divided into four groups, each group is a sextet, which in decimal is <code>19 22 05 46</code>, which is converted by the table to Base64, in this case we will get <code>TWFu</code>.</p>
<p>Ok, if our input can not be divide by three, there will be one or two characters left. What should we do?</p>
<p>Well, if there are only two significant input octets, or when the last input gorup contains only two octets. We just simply add more zeros to let it can be divided by three, and discarded on decoding (along with the following <code>=</code> padding characters ):</p>
<p><img src="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000208.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000208.webp" srcset="data:image/png;base64,666" alt="Img208"></p>
<p>And we do the same as there is only one significant input octet, or when the last input group contains only one octet:</p>
<p><img src="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000209.webp" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/LouiseDevTeam/ImagePack2@latest/00000209.webp" srcset="data:image/png;base64,666" alt="Img209"></p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>Since we know how base64 encode works, the next step is to consider how to write the codes.</p>
<p>You might implement structures named as Bit and Byte as what I do at first, which simply transform decimal to binary and concatenate all the binary in a single string, then divide it into four groups. Yeah, it works, but it really sucks with low performance. Don’t do that.</p>
<h3 id="Basic-knowledge"><a href="#Basic-knowledge" class="headerlink" title="Basic knowledge"></a>Basic knowledge</h3><p>In swift, we can get the binary sequence of a string by using <code>Data()</code>, for example, <code>var binaryData = Data(origin.utf8)</code>, then <code>binaryData</code> is a array which contains all the binary or <code>UInt8</code> representation under the <code>uf8</code> character encoding.</p>
<p>Considering <code>utf8</code> is so common and is capable with ASCII, we use <code>utf8</code> as the default string character encoding.</p>
<p>And we can use <code>and</code> operator (a.k.a <code>&amp;</code>) to get specific bit that we want from a binary. For example, if we want to get the last 4 bit from a binary, we simply calculate <code>100001010 &amp; 00001111</code>, we will get <code>00001010</code> as expected. </p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base64</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">Base64EncodeTable</span> <span class="operator">=</span> [<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>,<span class="string">&quot;F&quot;</span>,<span class="string">&quot;G&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;H&quot;</span>,<span class="string">&quot;I&quot;</span>,<span class="string">&quot;J&quot;</span>,<span class="string">&quot;K&quot;</span>,<span class="string">&quot;L&quot;</span>,<span class="string">&quot;M&quot;</span>,<span class="string">&quot;N&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;O&quot;</span>,<span class="string">&quot;P&quot;</span>,<span class="string">&quot;Q&quot;</span>,<span class="string">&quot;R&quot;</span>,<span class="string">&quot;S&quot;</span>,<span class="string">&quot;T&quot;</span>,<span class="string">&quot;U&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;V&quot;</span>,<span class="string">&quot;W&quot;</span>,<span class="string">&quot;X&quot;</span>,<span class="string">&quot;Y&quot;</span>,<span class="string">&quot;Z&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;g&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;h&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;j&quot;</span>,<span class="string">&quot;k&quot;</span>,<span class="string">&quot;l&quot;</span>,<span class="string">&quot;m&quot;</span>,<span class="string">&quot;n&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;o&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;q&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="string">&quot;s&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;u&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;v&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="string">&quot;z&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,</span><br><span class="line">                       <span class="string">&quot;7&quot;</span>,<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>,<span class="string">&quot;+&quot;</span>,<span class="string">&quot;/&quot;</span>]</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">Base64DecodeTable</span> : [<span class="type">String</span> : <span class="type">UInt8</span>] <span class="operator">=</span> [<span class="string">&quot;A&quot;</span>:<span class="number">0</span>,<span class="string">&quot;B&quot;</span>:<span class="number">1</span>,<span class="string">&quot;C&quot;</span>:<span class="number">2</span>,<span class="string">&quot;D&quot;</span>:<span class="number">3</span>,<span class="string">&quot;E&quot;</span>:<span class="number">4</span>,<span class="string">&quot;F&quot;</span>:<span class="number">5</span>,<span class="string">&quot;G&quot;</span>:<span class="number">6</span>,</span><br><span class="line">                         <span class="string">&quot;H&quot;</span>:<span class="number">7</span>,<span class="string">&quot;I&quot;</span>:<span class="number">8</span>,<span class="string">&quot;J&quot;</span>:<span class="number">9</span>,<span class="string">&quot;K&quot;</span>:<span class="number">10</span>,<span class="string">&quot;L&quot;</span>:<span class="number">11</span>,<span class="string">&quot;M&quot;</span>:<span class="number">12</span>,<span class="string">&quot;N&quot;</span>:<span class="number">13</span>,</span><br><span class="line">                         <span class="string">&quot;O&quot;</span>:<span class="number">14</span>,<span class="string">&quot;P&quot;</span>:<span class="number">15</span>,<span class="string">&quot;Q&quot;</span>:<span class="number">16</span>,<span class="string">&quot;R&quot;</span>:<span class="number">17</span>,<span class="string">&quot;S&quot;</span>:<span class="number">18</span>,<span class="string">&quot;T&quot;</span>:<span class="number">19</span>,<span class="string">&quot;U&quot;</span>:<span class="number">20</span>,</span><br><span class="line">                         <span class="string">&quot;V&quot;</span>:<span class="number">21</span>,<span class="string">&quot;W&quot;</span>:<span class="number">22</span>,<span class="string">&quot;X&quot;</span>:<span class="number">23</span>,<span class="string">&quot;Y&quot;</span>:<span class="number">24</span>,<span class="string">&quot;Z&quot;</span>:<span class="number">25</span>,</span><br><span class="line">                         <span class="string">&quot;a&quot;</span>:<span class="number">26</span>,<span class="string">&quot;b&quot;</span>:<span class="number">27</span>,<span class="string">&quot;c&quot;</span>:<span class="number">28</span>,<span class="string">&quot;d&quot;</span>:<span class="number">29</span>,<span class="string">&quot;e&quot;</span>:<span class="number">30</span>,<span class="string">&quot;f&quot;</span>:<span class="number">31</span>,<span class="string">&quot;g&quot;</span>:<span class="number">32</span>,</span><br><span class="line">                         <span class="string">&quot;h&quot;</span>:<span class="number">33</span>,<span class="string">&quot;i&quot;</span>:<span class="number">34</span>,<span class="string">&quot;j&quot;</span>:<span class="number">35</span>,<span class="string">&quot;k&quot;</span>:<span class="number">36</span>,<span class="string">&quot;l&quot;</span>:<span class="number">37</span>,<span class="string">&quot;m&quot;</span>:<span class="number">38</span>,<span class="string">&quot;n&quot;</span>:<span class="number">39</span>,</span><br><span class="line">                         <span class="string">&quot;o&quot;</span>:<span class="number">40</span>,<span class="string">&quot;p&quot;</span>:<span class="number">41</span>,<span class="string">&quot;q&quot;</span>:<span class="number">42</span>,<span class="string">&quot;r&quot;</span>:<span class="number">43</span>,<span class="string">&quot;s&quot;</span>:<span class="number">44</span>,<span class="string">&quot;t&quot;</span>:<span class="number">45</span>,<span class="string">&quot;u&quot;</span>:<span class="number">46</span>,</span><br><span class="line">                         <span class="string">&quot;v&quot;</span>:<span class="number">47</span>,<span class="string">&quot;w&quot;</span>:<span class="number">48</span>,<span class="string">&quot;x&quot;</span>:<span class="number">49</span>,<span class="string">&quot;y&quot;</span>:<span class="number">50</span>,<span class="string">&quot;z&quot;</span>:<span class="number">51</span>,</span><br><span class="line">                         <span class="string">&quot;0&quot;</span>:<span class="number">52</span>,<span class="string">&quot;1&quot;</span>:<span class="number">53</span>,<span class="string">&quot;2&quot;</span>:<span class="number">54</span>,<span class="string">&quot;3&quot;</span>:<span class="number">55</span>,<span class="string">&quot;4&quot;</span>:<span class="number">56</span>,<span class="string">&quot;5&quot;</span>:<span class="number">57</span>,<span class="string">&quot;6&quot;</span>:<span class="number">58</span>,</span><br><span class="line">                         <span class="string">&quot;7&quot;</span>:<span class="number">59</span>,<span class="string">&quot;8&quot;</span>:<span class="number">60</span>,<span class="string">&quot;9&quot;</span>:<span class="number">61</span>,<span class="string">&quot;+&quot;</span>:<span class="number">62</span>,<span class="string">&quot;/&quot;</span>:<span class="number">63</span>,<span class="string">&quot;=&quot;</span>:<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">toBase64</span><span class="params">(origin : String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> binaryData <span class="operator">=</span> <span class="type">Data</span>(origin.utf8)</span><br><span class="line">        <span class="keyword">let</span> latter : [<span class="type">UInt8</span>] <span class="operator">=</span> [<span class="number">0b00000011</span>, <span class="number">0b00001111</span>, <span class="number">0b00111111</span>]</span><br><span class="line">        <span class="keyword">var</span> buffer : <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00000000</span></span><br><span class="line">        <span class="keyword">var</span> res <span class="operator">=</span> <span class="type">String</span>()</span><br><span class="line">        <span class="keyword">var</span> placeholderCnt <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> (<span class="number">3</span> <span class="operator">-</span> binaryData.count <span class="operator">%</span> <span class="number">3</span>) <span class="operator">%</span> <span class="number">3</span> &#123;</span><br><span class="line">            binaryData.append(<span class="number">0b00000000</span>)</span><br><span class="line">            placeholderCnt <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> binaryData &#123;</span><br><span class="line">            <span class="keyword">if</span> count <span class="operator">==</span> <span class="number">3</span> &#123;</span><br><span class="line">                buffer <span class="operator">=</span> <span class="number">0b00000000</span></span><br><span class="line">                count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> delta <span class="operator">=</span> buffer <span class="operator">&lt;&lt;</span> ((<span class="number">3</span> <span class="operator">-</span> count) <span class="operator">&lt;&lt;</span> <span class="number">1</span>)</span><br><span class="line">            buffer <span class="operator">=</span> i <span class="operator">&amp;</span> latter[count]</span><br><span class="line">            res <span class="operator">+=</span> <span class="type">Base64EncodeTable</span>[<span class="type">Int</span>(delta <span class="operator">+</span> (i <span class="operator">&gt;&gt;</span> ((count <span class="operator">+</span> <span class="number">1</span>) <span class="operator">&lt;&lt;</span> <span class="number">1</span>)))]</span><br><span class="line">            <span class="keyword">if</span> count <span class="operator">==</span> <span class="number">2</span> &#123;</span><br><span class="line">                res <span class="operator">+=</span> <span class="type">Base64EncodeTable</span>[<span class="type">Int</span>(buffer)]</span><br><span class="line">            &#125;</span><br><span class="line">            count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//avoid compile warning</span></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> placeholderCnt &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> res.popLast()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> placeholderCnt &#123;</span><br><span class="line">            res.append(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">toString</span><span class="params">(origin : String)</span></span> -&gt; <span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> latter : [<span class="type">UInt8</span>] <span class="operator">=</span> [<span class="number">0b00000011</span>, <span class="number">0b00001111</span>, <span class="number">0b00111111</span>]</span><br><span class="line">        <span class="keyword">var</span> binaryData <span class="operator">=</span> [<span class="type">UInt8</span>]()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> origin &#123;</span><br><span class="line">            <span class="keyword">if</span> i <span class="operator">==</span> <span class="string">&quot;=&quot;</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            binaryData.append(<span class="type">Base64DecodeTable</span>[<span class="type">String</span>(i)]<span class="operator">!</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> data : <span class="type">Data</span> <span class="operator">=</span> <span class="type">Data</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> binaryData.count <span class="operator">-</span> <span class="number">1</span> &#123;</span><br><span class="line">            <span class="comment">//when count equals 3, all the value has been used in last loop</span></span><br><span class="line">            <span class="keyword">if</span> count <span class="operator">==</span> <span class="number">3</span> &#123;</span><br><span class="line">                count <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> delta <span class="operator">=</span> (binaryData[i] <span class="operator">&amp;</span> latter[<span class="number">3</span> <span class="operator">-</span> count <span class="operator">-</span> <span class="number">1</span>]) <span class="operator">&lt;&lt;</span> ((count <span class="operator">+</span> <span class="number">1</span>) <span class="operator">&lt;&lt;</span> <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">let</span> buffer <span class="operator">=</span> binaryData[i <span class="operator">+</span> <span class="number">1</span>] <span class="operator">&gt;&gt;</span> ((<span class="number">3</span> <span class="operator">-</span> count <span class="operator">-</span> <span class="number">1</span>) <span class="operator">&lt;&lt;</span> <span class="number">1</span>)</span><br><span class="line">            data.append(delta <span class="operator">+</span> buffer)</span><br><span class="line">            count <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">String</span>(data: data, encoding: .utf8)<span class="operator">!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="External-links"><a href="#External-links" class="headerlink" title="External links"></a>External links</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Base64">Base64</a></li>
</ul>

  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>Text is available under the Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</p>

              
            
              
                <p>The link of this work is: <a href=https://blog.5v5.lol/archives/6/>https://blog.5v5.lol/archives/6/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-01-08T17:33:44+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>This page was last edited on Jan 8, 2021</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/algorithm/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>algorithm</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/swift/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>swift</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
    
      
    
      
    
      
    
      
        <a class="-mob-share-telegram" title="" rel="external nofollow noopener noreferrer noopener"
          
            target="_blank" href="https://t.me/share/url?url=https://blog.5v5.lol/archives/6/&text=Algorithm in Swift -- Base64 - Macondo"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/telegram.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/telegram.png" srcset="data:image/png;base64,666">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
      
        <a class='next' href='/archives/3/'>
          <p class='title'>Algorithm in Swift -- Merge Sort<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>In this article we are going to talk about the Merge Sort.
IntroductionConceptually, a merge sort...</p>
        </a>
      
    </div>
  
</article>


  

  






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>TOC</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Base64-Table"><span class="toc-text">Base64 Table</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Examples"><span class="toc-text">Examples</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementation"><span class="toc-text">Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-knowledge"><span class="toc-text">Basic knowledge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code"><span class="toc-text">Code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#External-links"><span class="toc-text">External links</span></a></li></ol>
    </div>
  </section>


  


</aside>



        
        
          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="Algorithm in Swift -- Base64";
  pdata.commentPath="";
  pdata.commentPlaceholder="";

  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
</script>

        
      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div><p>Blog content follows the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.2.0" target="_blank" class="codename">Volantis</a>
        as theme
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2018-2020 Louise @ LDT</a></p>

        </div>
      
    
  </footer>


      <a id="s-top" class="fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <script>
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/********************脚本懒加载函数********************************/
function loadScript(src, cb) {
var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
var script = document.createElement('script');
script.setAttribute('type','text/javascript');
if (cb) script.onload = cb;
script.setAttribute('src', src);
HEAD.appendChild(script);
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  













  
<script src="/js/app.js"></script>



<!-- optional -->










  <script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://blog.5v5.lol' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://blog.5v5.lol' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://blog.5v5.lol' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>




  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
  try {
    localStorage.setItem(k, v);
  } catch (e) {
    console.log(e.message);
  }
};

const removeLS = (k) => {
  try {
    localStorage.removeItem(k);
  } catch (e) {
    console.log(e.message);
  }
};

const getLS = (k) => {
  try {
    return localStorage.getItem(k);
  } catch (e) {
    console.log(e.message);
    return null;
  }
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
function bindToggleButton() {
	var btn=$("#wrapper .toggle-mode-btn");
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
document.addEventListener("pjax:success", bindToggleButton);

</script>






<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#l_cover",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
       

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      
	 

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
        
        
        
        
        
        
        
        
        
      } catch (e) {
        console.log(e);
      }
	  
    });

    document.addEventListener('pjax:error', function (e) {
	  
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
